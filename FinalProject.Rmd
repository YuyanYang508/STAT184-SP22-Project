---
title: "FinalProject"
author: 'Yuyan Yang'
date: '4/22/2022'
output: html_notebook
---

### Load Library and Data

```{r message=FALSE,warning=FALSE}
# library
library(tidyverse)
library(lubridate)

# data
ratings <- read_csv('./data/ratings.csv', show_col_types = FALSE)
movies <- read_csv('./data/movies.csv', show_col_types = FALSE)
tags <- read_csv('./data/tags.csv', show_col_types = FALSE)
```

### Data Wrangling (Initial) Chunk 1

```{r message=FALSE,warning=FALSE}
# convert time stamp in ratings
ratings <- ratings %>%
  mutate(rating_date = as_datetime(timestamp))

# convert time stamp in tags
tags <- tags %>%
  mutate(tag_date = as_datetime(timestamp))

# first 3 rows for ratings
head(ratings,3)

# first 3 rows for tags
head(tags,3)
```

### Data Wrangling (Initial) Chunk 2

```{r}
# joins data where person both rated AND tagged movie. Then join movie info.
join <- ratings %>%
  inner_join(tags,by=c('userId','movieId')) %>%
  inner_join(movies,by='movieId') %>%
  select('userId', 'rating', 'rating_date', 'tag', 'tag_date', 'title', 'genres')

# first 3 rows for join
head(join,3)
```

### Data Wrangling (Initial) Chunk 3

```{r}
# move the year in the title variable to the new variable ‘release_year’ without parentheses
newJoin <- join %>%
  mutate(release_year = str_extract(title,"\\(\\d{4}\\)$")) %>%
  mutate(title = gsub(pattern = "\\(\\d{4}\\)$", replacement = "", title)) %>%
  mutate(release_year = gsub(pattern = "\\(", replacement = "", release_year)) %>%
  mutate(release_year = gsub(pattern = "\\)", replacement = "", release_year))

# first 3 rows for join
head(newJoin,3)
```

### Data Visualization Chunk 1

```{r}
# (1) What were the top 10 rated movie genres? That is, what were the ten genres rated most frequently?
# find out which genres are top 10 rated
top10 <- newJoin %>%
  group_by(genres) %>%
  summarise(count = n()) %>%
  arrange(desc(count)) %>%
  head(10)

# using ggplot to make a barplot
top10 %>%
  ggplot(aes(x = reorder(genres,-count), y = count)) +
  geom_bar(stat='identity') +
  ggtitle('Top 10 Rated Movie Genres') +
  xlab('Movie Genres') +
  ylab('Rated Frequency')
```

**Interpretation**: The top 10 rated movie genres are Drama, Comedy\|Crime\|Drama\|Thriller, Comedy, Drama\|Romance, Action\|Crime\|Drama\|Thriller, Comedy\|Drama\|Romance, Action\|Adventure\|Sci-Fi, Comedy\|Romance, Documentary, Comedy\|Drama. Lots of generes are overlapped, but I think I see an overall trend. People prefer Drama \> Comedy \> Action \> Romance \> Sci-fi \> Documentary. This matches with my personal experience because I like drama and comedy as well.

### Data Visualization Chunk 2

Question: What is the relationship between top 5 tag and release year of those movie?

```{r}
# The student should develop their own question and create a graph that answers that question plus meaninful, interpetive statement. The graph should include at least two variables, and use either color or fill options.

# find out what are the top 5 tags
top5Tag <- newJoin %>%
  group_by(tag) %>%
  summarise(count = n()) %>%
  arrange(desc(count)) %>%
  head(5)

# ggplot out tag vs. release year and color by ratings
newJoin %>%
  filter(tag %in% top5Tag$tag) %>%
  filter(rating %in% c('1','2','3','4','5')) %>%
  ggplot(aes(x = tag, y = as.numeric(release_year))) +
  geom_boxplot(aes(fill = factor(rating))) +
  scale_y_continuous(n.breaks = 10) +
  ggtitle('Top 5 Movie Tag vs. Release Year of Movies') +
  xlab('Top 5 Movie Tags') +
  ylab('Release Year of Movies') +
  scale_fill_discrete(name = "Ratings of movie")
```

**Interpretation**: From the Above Figure, we can clearly see that atmospheric and funny movies are mostly released in recent decades (after 1990s). From the box plots of Disney tag, we can also see that with the increase in release year, the ratings of movie is also improving. The Disney tagged movie released in 1940s to 1970s mainly has a relatively low rating (2 or 3); however, after 1970s, it start to earn 4 and 5 ratings. Another interesting finding is that 'In Netflix queue' tag indicates that netflix cover some verly old movies like movie released in 1940s.

### Resources

-   I used this link to findout how to break y-axis into more detailed numbers in ### Data Visualization Chunk 2

    -   <https://stackoverflow.com/questions/11335836/increase-number-of-axis-ticks>

### Github Repo

https://github.com/YuyanYang508/STAT184-SP22-Project
